---
tasks:
  main_ubuntu2204:
    name: build & test all
    platform: ubuntu2204
    build_flags:
    - "--cxxopt=-std=c++17"
    - "--host_cxxopt=-std=c++17"
    build_targets:
    - "//cpp/..."
    test_flags:
    - "--test_output=errors"
    - "--cxxopt=-std=c++17"
    - "--host_cxxopt=-std=c++17"
    test_targets:
    - "//example/routeguide:cpp_cpp"

  main_windows:
    name: build & test all
    platform: windows
    build_flags:
    - "--cxxopt=-std=c++17"
    - "--host_cxxopt=-std=c++17"
    build_targets:
    - "//cpp/..."
    test_flags:
    - "--test_output=errors"
    - "--cxxopt=-std=c++17"
    - "--host_cxxopt=-std=c++17"
    test_targets:
    - "//example/routeguide:cpp_cpp"

  main_macos:
    name: build & test all
    platform: macos
    build_flags:
    - "--cxxopt=-std=c++17"
    - "--host_cxxopt=-std=c++17"
    build_targets:
    - "//cpp/..."
    test_flags:
    - "--test_output=errors"
    - "--cxxopt=-std=c++17"
    - "--host_cxxopt=-std=c++17"
    test_targets:
    - "//example/routeguide:cpp_cpp"

  cpp_ubuntu2204_examples:
    name: cpp examples
    platform: ubuntu2204
    shell_commands:
     - set -x
     - make cpp_cpp_proto_compile_example
     - make cpp_cpp_grpc_compile_example
     - make cpp_cpp_proto_library_example
     - make cpp_cpp_grpc_library_example

  cpp_windows_examples:
    name: cpp examples
    platform: windows
    batch_commands:
     - make.exe cpp_cpp_proto_compile_example
     - make.exe cpp_cpp_grpc_compile_example
     - make.exe cpp_cpp_proto_library_example
     - make.exe cpp_cpp_grpc_library_example

  cpp_macos_examples:
    name: cpp examples
    platform: macos
    shell_commands:
     - set -x
     - make cpp_cpp_proto_compile_example
     - make cpp_cpp_grpc_compile_example
     - make cpp_cpp_proto_library_example
     - make cpp_cpp_grpc_library_example

  ubuntu2204_test_workspaces:
    name: test workspaces
    platform: ubuntu2204
    shell_commands:
     - set -x
     - make test_workspace_absolute_strip_import_prefix
     - make test_workspace_combined_strip_and_add_prefix
     - make test_workspace_common_cpp_library
     - make test_workspace_empty_output_directory
     - make test_workspace_exclusions
     - make test_workspace_generated_proto
     - make test_workspace_go_fixer
     - make test_workspace_go_importpath
     - make test_workspace_import_prefix
     - make test_workspace_nested_output_directory
     - make test_workspace_objc_capitalisation
     - make test_workspace_python3_grpc
     - make test_workspace_python_dashes
     - make test_workspace_python_deps
     - make test_workspace_readme_http_archive
     - make test_workspace_relative_strip_import_prefix
     - make test_workspace_shared_proto
     - make test_workspace_special_characters

  windows_test_workspaces:
    name: test workspaces
    platform: windows
    batch_commands:
     - make.exe test_workspace_absolute_strip_import_prefix
     - make.exe test_workspace_combined_strip_and_add_prefix
     - make.exe test_workspace_common_cpp_library
     - make.exe test_workspace_empty_output_directory
     - make.exe test_workspace_exclusions
     - make.exe test_workspace_generated_proto
     - make.exe test_workspace_go_fixer
     - make.exe test_workspace_go_importpath
     - make.exe test_workspace_import_prefix
     - make.exe test_workspace_nested_output_directory
     - make.exe test_workspace_objc_capitalisation
     - make.exe test_workspace_python3_grpc
     - make.exe test_workspace_python_dashes
     - make.exe test_workspace_python_deps
     - make.exe test_workspace_readme_http_archive
     - make.exe test_workspace_relative_strip_import_prefix
     - make.exe test_workspace_shared_proto
     - make.exe test_workspace_special_characters

  macos_test_workspaces:
    name: test workspaces
    platform: macos
    shell_commands:
     - set -x
     - make test_workspace_absolute_strip_import_prefix
     - make test_workspace_combined_strip_and_add_prefix
     - make test_workspace_common_cpp_library
     - make test_workspace_empty_output_directory
     - make test_workspace_exclusions
     - make test_workspace_generated_proto
     - make test_workspace_go_fixer
     - make test_workspace_go_importpath
     - make test_workspace_import_prefix
     - make test_workspace_nested_output_directory
     - make test_workspace_objc_capitalisation
     - make test_workspace_python3_grpc
     - make test_workspace_python_dashes
     - make test_workspace_python_deps
     - make test_workspace_readme_http_archive
     - make test_workspace_relative_strip_import_prefix
     - make test_workspace_shared_proto
     - make test_workspace_special_characters
